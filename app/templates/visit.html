<div class="container">
	<div class="main">
        	<div class="title">
			Guest & Visitor
			</div>
			Home > Guest & Visitors
			{{ tomorrow }}<br>
			{{ afterTomorrow}}
			<div class="row">
				<div class="col-md-4 pull-right">
								<a class="btn btn-default pull-right" ><img class="img-btn" src="../../assets/image/icon_print.png" (click)="viewPdf(petitionPending)" />&nbsp;Print</a>
						  		<button type="button" class="btn btn-default pull-right" (click)="firstModal.open()"><img class="img-btn" src="../../assets/image/icon_add.png"  />&nbsp;Add Visitor/Guest</button>
				</div>
			</div>
			
			<div class="row bg-dark">
                <div class="col-md-2 col-md-offset-2 btn-underline " (click)="previousDay()">
                    <span class="pull-right" style="margin-top: 10px"><img src="../../assets/image/icon_arrowleft_white.png" ></span>
                </div>
                <div class="col-md-4 text-center">
    				<my-date-picker class="bg-dark" [options]="DateOptions" [selDate]="activeDate" (dateChanged)="onPickerClick($event)"></my-date-picker>

                    <span  style="font-size: 16px; font-weight: 500px; position: relative;
                        bottom: 10px;">
                        {{ activeDate | date:'fullDate'}}
    				</span>
                </div>
                <div class="col-md-2 btn-underline " (click)="nextDay()">
                    <span class="pull-left" style="margin-top: 10px"><img src="../../assets/image/icon_arrowright_white.png" ></span>
                </div>
			</div>
			<div class="row">
			    	<p-dataTable [value]="visitActive" scrollable="true" scrollHeight="380px">
					    <p-column header="No" [style]="{'width':'42px'}" field="i">
						</p-column>
						<p-column header="Visitor/Guest" field="" filterPlaceholder="Search Name">
					    	<template let-visitActive="rowData" pTemplate="body">
					            <span>{{visitActive.visitor.prefix}} {{visitActive.visitor.full_name}}</span>
					        </template>
						</p-column>
						<p-column header="Vehicle" field="" filterPlaceholder="Search vehicle">
					    	<template let-visitActive="rowData" pTemplate="body">
                                <span *ngIf="visitActive.visitor.vehicle==''">N/A</span>
					            <span>{{visitActive.visitor.vehicle}}</span>
					        </template>
						</p-column>
						<p-column header="Visiting" field="" filterPlaceholder="Search unit no">
					    	<template let-visitActive="rowData" pTemplate="body">
					            <span *ngIf="visitActive.property==''">N/A</span>
                                <span>{{visitActive.property}}</span>
					        </template>
						</p-column>
						<p-column field="purpose" header="Purpose of visit" ></p-column>
                        <p-column header="Remarks" field="">
                            <template let-visitActive="rowData" pTemplate="body">
                                <span *ngIf="visitActive.remarks==''">No remarks</span>
                                <span>{{visitActive.remarks}}</span>
                            </template>
                        </p-column>
					    <p-column header="Added by" field="" sortable="true">visitActive
					    	<template let-visitActive="rowData" pTemplate="body">
					            <span class="btn-underline">{{visitActive.created_by}}</span><br>
					            <span class="btn-underline">on {{visitActive.created_at}}</span>
					        </template>
						</p-column>
						<p-column header="Card no" field="" sortable="true">
					    	<template let-visitActive="rowData" pTemplate="body">
                                <span *ngIf="visitActive.visitor.pass==''">-</span>
					            <span class="btn-underline">{{visitActive.visitor.pass}}</span>
					        </template>
						</p-column>
					    <p-column [style]="{'width':'300px'}" styleClass="col-button" field="" header="Check in/out">
					    	<template let-visitActive="rowData" pTemplate="body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <button *ngIf="(!visitActive.check_in && !visitActive.check_out) || (visitActive.check_in && visitActive.check_out)" [disabled]="visitActive.check_in != '' && visitActive.check_out != '' " type="button" class="btn btn-default" (click)="preCheckIn(visitActive) || checkInModal.open()">IN</button>
                                        <button *ngIf="visitActive.check_in && !visitActive.check_out" type="button" class="btn btn-primary" (click)="preCheckOut(visitActive) || checkOutModal.open()">OUT</button>
                                    </div>
                                    <div class="col-md-8">
                                        <small *ngIf="visitActive.check_in">in {{ visitActive.check_in | date:'mediumTime' }}&nbsp;{{ visitActive.check_in | date:'shortDate' }}</small><br>
                                        <small *ngIf="visitActive.check_out">out {{ visitActive.check_out | date:'mediumTime' }}&nbsp;{{ visitActive.check_out | date:'shortDate' }}</small>
                                    </div>
                                </div>
					    	
					    	</template>
					    </p-column>
					</p-dataTable>
			</div>
       
		<div class="row">
		    <modal #firstModal>
		        <modal-header>
		            <h5>Adding Guest/Visitor</h5>
		        </modal-header>
		        <modal-content>
					<form name="form" [formGroup]="myForm" novalidate>
						<div class="form-group" [ngClass]="{ 'has-error': addSubmitted && !myForm.controls.visitor.controls.full_name.valid }" formGroupName="visitor">
                            <label  class="control-label col-sm-4" for="full_name">Name of Guest/visitor :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="full_name" formControlName="full_name">
                                <small style="color: red" [hidden]="myForm.controls.visitor.controls.full_name.valid || (myForm.controls.visitor.controls.full_name.pristine && !addSubmitted)">Name is required</small>
                            </div>
                        </div>
                        <div class="form-group" formGroupName="visitor">
                            <label  class="control-label col-sm-4" for="vehicle">Vehicle :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" placeholder="If any" name="vehicle" formControlName="vehicle">
                            </div>
                        </div>
                        <div class="form-group" formGroupName="visitor">
                            <label  class="control-label col-sm-4" for="vehicle">Visit date:</label>
                            <div class="col-sm-8">
                            <my-date-picker class="bg-dark" [options]="visitDateCreateOptions" [selDate]="visitDateCreate" (dateChanged)="visitDateCreateChanged($event)"></my-date-picker>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-4" for="purpose">Purpose of visit :</label>
                            <div class="col-sm-8">
                                <select class="form-control" formControlName="purpose" name="purpose">
                                    <option selected="" value="house_visit">House Visit</option>
                                    <option value="maintenance_work">Maintenance Work</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group" [ngClass]="{ 'has-error': addSubmitted && !myForm.controls.property.valid }">
                            <label  class="control-label col-sm-4" for="full_name">Visiting :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="property" formControlName="property">
                                <small style="color: red" [hidden]="myForm.controls.property.valid || (myForm.controls.property.pristine && !addSubmitted)">Unit no is required</small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label  class="control-label col-sm-4" for="full_name">Remarks :</label>
                            <div class="col-sm-8">
                                <textarea  type="text" class="form-control" name="remarks" formControlName="remarks" placeholder="Remarks here if any"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label  class="control-label col-sm-4" for="full_name">Check-in: :</label>
                            <div class="col-sm-8">
                              	<label><input type="radio" formControlName="check_in" name="check_in" [value]=true>Yes</label>
                        		<label><input type="radio" formControlName="check_in" [checked]=true name="check_in" [value]=false>No</label>
                        	</div>
                        </div>
                       	<div class="form-group" formGroupName="visitor">
                            <label  class="control-label col-sm-4" for="pass">Visitor Pass :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" placeholder="Enter Pass serial" name="pass" formControlName="pass">
                            </div>
                        </div>
                        <div class="pull-right">
                            <button  class="btn btn-primary" (click)="addGuest(myForm.value, myForm.valid)">Add</button>
                            <button class="btn btn-default" (click)="firstModal.close()">Cancel</button>
                        </div>
		            </form>   
		        </modal-content>
		    </modal>
		</div>	

		<div class="row">
		    <modal #checkInModal>
                <modal-header *ngIf="visit">
                    <h5>Check-in {{ visit.visitor.prefix }}&nbsp;{{ visit.visitor.full_name }}</h5>
                </modal-header>
                <modal-content *ngIf="visit">
                    <form name="form" [formGroup]="checkInForm" novalidate>
                        <div class="form-group" formGroupName="visitor">
                            <label  class="control-label col-sm-4" for="full_name">Name of Guest/visitor :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="full_name" formControlName="full_name">
                            </div>
                        </div>
                        <div class="form-group" formGroupName="visitor">
                            <label  class="control-label col-sm-4" for="vehicle">Vehicle :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" placeholder="If any" name="vehicle" formControlName="vehicle">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-4" for="purpose">Purpose of visit :</label>
                            <div class="col-sm-8">
                                <select class="form-control" formControlName="purpose" name="purpose">
                                    <option [selected]="visit.purpose=='house_visit'" value="house_visit">House Visit</option>
                                    <option [selected]="visit.purpose=='maintenance_work'" value="maintenance_work">Maintenance Work</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group" >
                            <label  class="control-label col-sm-4" for="full_name">Visiting :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="property" formControlName="property">
                            </div>
                        </div>
                        <div class="form-group">
                            <label  class="control-label col-sm-4" for="full_name">Remarks :</label>
                            <div class="col-sm-8">
                                <textarea  type="text" class="form-control" name="remarks" formControlName="remarks" placeholder="Remarks here if any"></textarea>
                            </div>
                        </div>
                        <div class="form-group" [ngClass]="{ 'has-error': checkInSsubmitted && !checkInForm.controls.visitor.controls.pass.valid }" formGroupName="visitor">
                            <label  class="control-label col-sm-4" for="pass">Visitor Pass :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" placeholder="Enter Pass serial" name="pass" formControlName="pass">
                                <small style="color: red" [hidden]="checkInForm.controls.visitor.controls.pass.valid || (checkInForm.controls.visitor.controls.pass.pristine && !checkInSsubmitted)">Pass number is required</small>
                            </div>
                        </div>
                        <div class="pull-right">
                            <button  class="btn btn-primary" (click)="checkIn(checkInForm.value, checkInForm.valid)">Check-In</button>
                            <button class="btn btn-default" (click)="checkInModal.close()">Cancel</button>
                        </div>
                    </form>   
                </modal-content>
		    </modal>
		</div>	

        <div class="row">
            <modal #checkOutModal>
                <modal-header *ngIf="visitOut">
                    <h5>Check-out {{ visitOut.visitor.prefix }}&nbsp;{{ visitOut.visitor.full_name }}</h5>
                </modal-header>
                <modal-content *ngIf="visitOut">
                    <form name="form" [formGroup]="checkOutForm" (ngSubmit)="checkOut(checkOutForm.value, checkOutForm.valid)" novalidate>
                       <div class="form-group" [ngClass]="{ 'has-error': checkOutSsubmitted && !checkOutForm.controls.visitor.controls.pass.valid }" formGroupName="visitor">
                            <label  class="control-label col-sm-4" for="pass">Visitor Pass :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" placeholder="Enter Pass serial" name="pass" formControlName="pass">
                                <small style="color: red" [hidden]="checkOutForm.controls.visitor.controls.pass.valid || (checkOutForm.controls.visitor.controls.pass.pristine && !checkInSsubmitted)">Pass number is required</small>
                            </div>
                        </div>
                        <div class="pull-right">
                            <button  class="btn btn-primary" >Check-Out</button>
                            <a class="btn btn-default" (click)="checkOutModal.close()">Cancel</a>
                        </div>
                    </form>   
                </modal-content>
            </modal>
        </div>  
	</div>
</div>

        <style>
            @import "./styles/visit.css";
        </style>